<center>
<h1><%= @traffic_camera.name %></h1>

<% captures = @traffic_camera.captures.sort_by { |c| c[:time_ms] }.last(20) %>
<div id="traffic-camera-animation">
  <% captures.each_with_index do |capture, index| %>
    <div class="camera-frame" style="<%= index == 0 ? 'display: block;' : 'display: none;' %>">
      <%= image_tag traffic_camera_capture_path(@traffic_camera, time_ms: capture[:time_ms]),
                    alt: "Traffic camera image at #{Time.at(capture[:time]).strftime('%Y-%m-%d %H:%M:%S')}",
                    class: "camera-image img-fluid" %>
      <br/><code><%= Time.at(capture[:time]).strftime('%Y-%m-%d %H:%M:%S') %> (<%= sprintf('%03d', index) %>)</code><br/>
    </div>
  <% end %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const images = document.querySelectorAll('#traffic-camera-animation .camera-frame');
    let currentIndex = 0;

    function showNextImage() {
      images[currentIndex].style.display = 'none';
      currentIndex = (currentIndex + 1) % images.length;
      images[currentIndex].style.display = 'block';
    }

    setInterval(showNextImage, 500); // Change image every 1 second
  });
</script>
</center>